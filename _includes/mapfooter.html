<script>

    markers = [
        {% for item in site.markers %}
            {% if item.lat and item.lng %}
                {% assign i = i | plus: 1 %}{% if i > 1 %},{% endif %}
                {
                    "name": '{{ item.title | replace:"'","\'" }}',
                    "url": "{{ item.url | prepend: site.url }}",
                    "lat": {{ item.lat }},
                    "lng": {{ item.lng }}
                }
            {% endif %}
        {% endfor %}
    ];
    var map = L.map( 'map', {
        center: [52.327030, 4.859848],
        minZoom: 5,
        zoom: 16,
        scrollWheelZoom: false,
        zoomControl: true
    });
    map.zoomControl.setPosition('topright');
    L.Icon.Default.imagePath = '{{ site.baseurl }}/js/images/';

    //L.tileLayer('https://b.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    L.tileLayer('https://c.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors',
    }).addTo( map );

    for ( var i=0; i < markers.length; ++i ) {
        L.marker( [markers[i].lat, markers[i].lng], {title: markers[i].name} )
            .on('click', onClick, markers[i])
            .addTo( map );
    }

    function geoFindMe() {

        const status = document.querySelector('#status');

        function success(position) {
            const latitude  = position.coords.latitude;
            const longitude = position.coords.longitude;

            status.textContent = '';
            map.flyTo([latitude, longitude], 14)
        }

        function error() {
            status.textContent = 'Unable to retrieve your location';
        }

        if(!navigator.geolocation) {
            status.textContent = 'Geolocation is not supported by your browser';
        } else {
            status.textContent = 'Locating...';
            navigator.geolocation.getCurrentPosition(success, error);
        }

    }
    
    document.querySelector('#find-me').addEventListener('click', geoFindMe);

</script>